version: '3.8'
 
services:
    qdrant:
      image: qdrant/qdrant:latest
      container_name: qdrant
      ports:
        - "6333:6333"
      volumes:
        - ./qdrant_data:/qdrant/storage
      restart: unless-stopped
      healthcheck:
        test: ["CMD", "curl", "-f", "http://localhost:6333/healthz"]
        interval: 5s
        timeout: 5s
        retries: 5

    voice-journal-bot:
      build: .
      container_name: voice-journal-bot
      depends_on:
        qdrant:
          condition: service_healthy
      environment:
      - TELEGRAM_TOKEN=${TELEGRAM_TOKEN}
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - LLM_PROVIDER=${LLM_PROVIDER:-deepseek}
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333
    volumes:
      - ./data:/app/data
      - ./qdrant_data:/app/qdrant_data
    restart: unless-stopped
